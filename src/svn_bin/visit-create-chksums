#!/bin/sh
#-----------------------------------------------------------------------
#
# VISIT-CREATE-CHKSUMS - Create lists of the md5 checksums, sha1
#                        checksums, and file sizes for the visit
#                        distribution.
#
# Author: Eric Brugger
# Date:   August 30, 2005
#
# Usage:
#    visit-create-chksums -v <version> -d <distribution>
#
#-----------------------------------------------------------------------

dist=undefined
version=undefined

#
# The loop is executed once for each symbol on the execute line.  This means
# that $1 may be blank for later executions of the loop if any "shift 2"
# commands are executed.  The variable abc is not used in the loop.  
#
for abc
do
   case $1 in
      -d)
         dist=$2
         shift 2
         ;;
      -v)
         version=$2
         shift 2
         ;;
   esac
done

#
# Check that the distribution name and version number was provided.
#
if [ $dist = undefined ]
then
   echo "Usage: -v <version> -d <distribution>"
   exit
fi

if [ $version = undefined ]
then
   echo "Usage: -v <version> -d <distribution>"
   exit
fi

version2=`echo $version | tr "." "_"`

#
# Create an awk script for use with the filesize command
#
rm -f format_filesize
cat <<EOF > format_filesize
BEGIN { FS = " " }
      { printf "%-25s %s\n", \$5, \$9}
EOF

#
# Create a script to generate the file size.
#
rm -f filesize
cat <<EOF > filesize
#!/bin/sh
ls -l \$1 | sed "s/  */ /g" | gawk -f ../visit$version/format_filesize
EOF
chmod 755 filesize

#
# Create the md5 checksums, the sha1 checksums, and the file sizes.
#
cmds="md5sum sha1sum ../visit$version/filesize"
for cmd in $cmds
do
   case $cmd in
      md5sum)
         property=checksums
         output=visit_md5_checksums
         ;;
      sha1sum)
         property=checksums
         output=visit_sha1_checksums
         ;;
      ../visit$version/filesize)
         property="file sizes"
         output=visit_filesizes
         ;;
   esac

   rm -f $output

   echo ""                                         >  $output
   echo "The VisIt executable $property"           >> $output
   echo ""                                         >> $output
   $cmd INSTALL_NOTES                              >> $output
   $cmd visit-install                              >> $output
   $cmd jvisit$version.tar.gz                      >> $output
   $cmd visit$version.exe                          >> $output
   $cmd visit$version2.aix.tar.gz                  >> $output
   $cmd visit$version2.aix64.tar.gz                >> $output
   $cmd visit$version2.darwin-ppc.tar.gz           >> $output
   $cmd visit$version2.darwin-i386-parallel.tar.gz >> $output
   $cmd visit$version2.darwin-i386.tar.gz          >> $output
   $cmd visit$version2.linux-altix.tar.gz          >> $output
   $cmd visit$version2.linux-ellipse.tar.gz        >> $output
   $cmd visit$version2.linux-x86_64-fedora4.tar.gz >> $output
   $cmd visit$version2.linux-x86_64-ubuntu8.tar.gz >> $output
   $cmd visit$version2.linux-x86_64.tar.gz         >> $output
   $cmd visit$version2.linux_rhel3.tar.gz          >> $output

   echo ""                                         >> $output
   echo "The VisIt source code $property"          >> $output
   echo ""                                         >> $output
   $cmd BUILD_NOTES                                >> $output
   $cmd BUILD_NOTES_MacOSX                         >> $output
   $cmd build_visit                                >> $output
   $cmd $dist.tar.gz                               >> $output
   $cmd visitdev$version.exe                       >> $output
   cd ../visit_third_party
   $cmd boxlib.tar.gz                              >> ../visit$version/$output
   $cmd libccmio-2.6.1.tar.gz                      >> ../visit$version/$output
   $cmd cfitsio3006.tar.gz                         >> ../visit$version/$output
   $cmd cgnslib_2.4-3.tar.gz                       >> ../visit$version/$output
   $cmd cmake-2.2.3.tar.gz                         >> ../visit$version/$output
   $cmd cmake-2.4.5.tar.gz                         >> ../visit$version/$output
   $cmd exodusii-4.46.tar.gz                       >> ../visit$version/$output
   $cmd gdal-1.3.2.tar.gz                          >> ../visit$version/$output
   $cmd H5Part-20070711.tar.gz                     >> ../visit$version/$output
   $cmd HDF4.2r1.tar.gz                            >> ../visit$version/$output
   $cmd hdf5-1.6.5.tar.gz                          >> ../visit$version/$output
   $cmd hdf5-1.8.1.tar.gz                          >> ../visit$version/$output
   $cmd Imaging-1.1.6.tar.gz                       >> ../visit$version/$output
   $cmd Mesa-5.0-mangled.tar.gz                    >> ../visit$version/$output
   $cmd MesaLib-6.4.2.tar.gz                       >> ../visit$version/$output
   $cmd netcdf.tar.gz                              >> ../visit$version/$output
   $cmd Python-2.5.tgz                             >> ../visit$version/$output
   $cmd qt-mac-free-3.3.8.tar.gz                   >> ../visit$version/$output
   $cmd qt-x11-free-3.3.2.tar.gz                   >> ../visit$version/$output
   $cmd qt-x11-free-3.3.8.tar.gz                   >> ../visit$version/$output
   $cmd silo-4.6.1.tar.gz                          >> ../visit$version/$output
   $cmd silo-4.6.2.tar.gz                          >> ../visit$version/$output
   $cmd silo060605.sh                              >> ../visit$version/$output
   $cmd szip-2.1.tar.gz                            >> ../visit$version/$output
   $cmd vtk-5.0.0c.tar.gz                          >> ../visit$version/$output
   cd ../visit$version

   shift
done
