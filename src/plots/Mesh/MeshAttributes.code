Target: xml2python
Code: PyMeshAttributes_getattr
Prefix:
Postfix:
    // Try and handle legacy fields in MeshAttributes
    if(strcmp(name, "backgroundFlag") == 0)
    {
        MeshAttributesObject *meshObj = (MeshAttributesObject *)self;
        bool backgroundFlag = meshObj->data->GetOpaqueColorSource() == MeshAttributes::Background;
        return PyInt_FromLong(backgroundFlag?1L:0L);
    }
    else if(strcmp(name, "foregroundFlag") == 0)
    {
        MeshAttributesObject *meshObj = (MeshAttributesObject *)self;
        bool foregroundFlag = meshObj->data->GetMeshColorSource() == MeshAttributes::Foreground;
        return PyInt_FromLong(foregroundFlag?1L:0L);
    }

    // lineStyle and it's possible enumerations
    bool lineStyleFound = false;
    if (strcmp(name, "lineStyle") == 0)
    {
        lineStyleFound = true;
    }
    else if (strcmp(name, "SOLID") == 0)
    {
        lineStyleFound = true;
    }
    else if (strcmp(name, "DASH") == 0)
    {
        lineStyleFound = true;
    }
    else if (strcmp(name, "DOT") == 0)
    {
        lineStyleFound = true;
    }
    else if (strcmp(name, "DOTDASH") == 0)
    {
        lineStyleFound = true;
    }
    if (lineStyleFound)
    {
        fprintf(stdout, "lineStyle is no longer a valid Mesh "
                       "attribute.\nIt's value is being ignored, please remove "
                       "it from your script.\n");
        return PyInt_FromLong(0L);
    }



Code: PyMeshAttributes_setattr
Prefix:
Postfix:
    // Try and handle legacy fields in MeshAttributes
    if(obj == NULL)
    {
        MeshAttributesObject *meshObj = (MeshAttributesObject *)self;
        if(strcmp(name, "backgroundFlag") == 0)
        {
            int ival;
            if(!PyArg_ParseTuple(tuple, "i", &ival))
            {
                Py_DECREF(tuple);
                return -1;
            }
            if(ival == 0)
                meshObj->data->SetOpaqueColorSource(MeshAttributes::OpaqueCustom);
            else
                meshObj->data->SetOpaqueColorSource(MeshAttributes::Background);

            Py_INCREF(Py_None);
            obj = Py_None;
        }
        else if(strcmp(name, "foregroundFlag") == 0)
        {
            int ival;
            if(!PyArg_ParseTuple(tuple, "i", &ival))
            {
                Py_DECREF(tuple);
                return -1;
            }
            if(ival == 0)
                meshObj->data->SetMeshColorSource(MeshAttributes::MeshCustom);
            else
                meshObj->data->SetMeshColorSource(MeshAttributes::Foreground);

            Py_INCREF(Py_None);
            obj = Py_None;
        }
        else if(strcmp(name, "lineStyle") == 0)
        {
            Py_INCREF(Py_None);
            obj = Py_None;
        }
    }

Target: xml2atts
Function: ChangesRequireRecalculation
Declaration: bool ChangesRequireRecalculation(const MeshAttributes &, const int);
Definition:
// ****************************************************************************
//  Modifications:
//
//    Kathleen Bonnell, Wed Aug 22 16:00:32 PDT 2001
//    Changing opaque mode no longer requires recalculation.
//
//    Jeremy Meredith, Mon Dec  9 16:30:54 PST 2002
//    Added smoothing level.
//
//    Jeremy Meredith, Fri Dec 20 11:33:43 PST 2002
//    Added point size variable and its enabled flag.
//
//    Hank Childs, Thu Aug 21 23:05:45 PDT 2003
//    Added point type.
//
//    Kathleen Bonnell, Thu Feb  5 13:07:06 PST 2004
//    Added spatDim argument, added showInternal.
//
//    Kathleen Bonnell, Tue Nov  2 10:32:21 PST 2004
//    Removed point type and point size from test, changed pointSizeVar test
//    so that only true if changes require adding new secondary varaible.
//
//    Kathleen Biagas, Thu Apr 23 13:14:51 PDT 2015
//    Removed never-used oulineOnly and errorTolerance atts.
//
// ****************************************************************************

bool
MeshAttributes::ChangesRequireRecalculation(const MeshAttributes &obj,
                                            const int spatDim)
{
    bool needSecondaryVar = (obj.pointSizeVarEnabled &&
                            ((pointSizeVar != obj.pointSizeVar) &&
                             (obj.pointSizeVar != "default") &&
                             (obj.pointSizeVar != "") &&
                             (obj.pointSizeVar != "\0")));

    return ((needSecondaryVar) ||
            (smoothingLevel != obj.smoothingLevel) ||
            (showInternal != obj.showInternal && spatDim == 3));
}

Function: ProcessOldVersions
Declaration: virtual void ProcessOldVersions(DataNode *parentNode, const char *configVersion);
Definition:
// ****************************************************************************
// Method: MeshAttributes::ProcessOldVersions
//
// Purpose:
//   This method handles some old fields by converting them to new fields.
//
// Programmer: Brad Whitlock
// Creation:   Fri Mar 12 09:33:52 PST 2010
//
// Modifications:
//
// ****************************************************************************
#include <Utility.h>
void
MeshAttributes::ProcessOldVersions(DataNode *parentNode,
    const char *configVersion)
{
    if(parentNode == 0)
        return;

    DataNode *searchNode = parentNode->GetNode("MeshAttributes");
    if(searchNode == 0)
        return;

    if(VersionLessThan(configVersion, "2.0.0"))
    {
        DataNode *k = 0;
        if((k = searchNode->GetNode("foregroundFlag")) != 0)
        {
            MeshColor val = k->AsBool() ? Foreground : MeshCustom;
            searchNode->RemoveNode(k, true);
            searchNode->AddNode(new DataNode("meshColorSource", MeshColor_ToString(val)));
        }
        if((k = searchNode->GetNode("backgroundFlag")) != 0)
        {
            OpaqueColor val = k->AsBool() ? Background : OpaqueCustom;
            searchNode->RemoveNode(k, true);
            searchNode->AddNode(new DataNode("opaqueColorSource", OpaqueColor_ToString(val)));
        }
    }
    if(VersionLessThan(configVersion, "3.0.0"))
    {
        if (searchNode->GetNode("lineStyle") != 0)
            searchNode->RemoveNode("lineStyle");
    }
}

Target: xml2info
Function: MeshViewerEnginePluginInfo::InitializePlotAtts
Declaration: virtual void InitializePlotAtts(AttributeSubject *atts, const avtPlotMetaData &);
Definition:
// ****************************************************************************
//  Method: MeshViewerEnginePluginInfo::InitializePlotAtts
//
//  Purpose:
//    Initialize the plot attributes to the default attributes.
//
//  Arguments:
//    atts      The attribute subject to initialize.
//    md        The metadata used to initialize.
//    atts      The variable name used to initialize.
//
//  Programmer: miller86 -- generated by xml2info
//  Creation:   Mark C. Miller, Thu May 30 22:41:29 PDT 2019
// ****************************************************************************
static int colorIndex = 0;
// Grabbed 29May19 from https://sashat.me/2017/01/11/list-of-20-simple-distinct-colors/
static unsigned char SashaTrubetskoy22SimpleDistinctColors[][4] = {
    {230,  25,  75, 255}, { 60, 180,  75, 255}, {255, 225,  25, 255}, {  0, 130, 200, 255}, {245, 130,  48, 255},
    {145,  30, 180, 255}, { 70, 240, 240, 255}, {240,  50, 230, 255}, {210, 245,  60, 255}, {250, 190, 190, 255},
    {  0, 128, 128, 255}, {230, 190, 255, 255}, {170, 110,  40, 255}, {255, 250, 200, 255}, {128,   0,   0, 255},
    {170, 255, 195, 255}, {128, 128,   0, 255}, {255, 215, 180, 255}, {  0,   0, 128, 255}, {128, 128, 128, 255},
    {255, 255, 255, 255}, {  0,   0,   0, 255}};
void
MeshViewerEnginePluginInfo::InitializePlotAtts(AttributeSubject *atts,
    const avtPlotMetaData &)
{
    *(MeshAttributes*)atts = *defaultAtts;
    SetOpaqueColor(atts);
    SetMeshColor(atts);
}

Function: MeshViewerEnginePluginInfo::SetMeshColor
Declaration: void SetMeshColor(AttributeSubject *);
Definition:
// ****************************************************************************
//  Method: MeshViewerEnginePluginInfo::SetMeshColor
//
//  Purpose:
//    Sets the mesh color if the MeshRandom att is set to true. 
//
//  Arguments:
//    atts      The attribute subject. 
//
//  Programmer: Mark C. Miller, Thu May 30 22:41:51 PDT 2019
// ****************************************************************************
void
MeshViewerEnginePluginInfo::SetMeshColor(AttributeSubject *atts)
{
    MeshAttributes *meshAtts = (MeshAttributes *)atts;

    if (meshAtts->GetMeshColorSource() == MeshAttributes::MeshRandom)
    {
        ColorAttribute c;

        c.SetColor(SashaTrubetskoy22SimpleDistinctColors[colorIndex]);

        meshAtts->SetMeshColor(c);

        // Increment the color index.
        colorIndex = (colorIndex + 1) % 22;
    }
}

Function: MeshViewerEnginePluginInfo::SetOpaqueColor
Declaration: void SetOpaqueColor(AttributeSubject *);
Definition:
// ****************************************************************************
//  Method: MeshViewerEnginePluginInfo::SetOpaqueColor
//
//  Purpose:
//    Sets the mesh color if the MeshRandom att is set to true. 
//
//  Arguments:
//    atts      The attribute subject. 
//
//  Programmer: Mark C. Miller, Thu May 30 22:41:51 PDT 2019
// ****************************************************************************
void
MeshViewerEnginePluginInfo::SetOpaqueColor(AttributeSubject *atts)
{
    MeshAttributes *meshAtts = (MeshAttributes *)atts;

    if (meshAtts->GetOpaqueColorSource() == MeshAttributes::OpaqueRandom)
    {
        ColorAttribute c;

        c.SetColor(SashaTrubetskoy22SimpleDistinctColors[colorIndex]);

        meshAtts->SetOpaqueColor(c);

        // Increment the color index.
        colorIndex = (colorIndex + 1) % 22;
    }
}

