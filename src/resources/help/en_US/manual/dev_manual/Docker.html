

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Docker &mdash; VisIt User Manual 2.11 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="VisIt User Manual 2.11 documentation" href="../index.html"/>
        <link rel="up" title="VisIt Developer Manual" href="index.html"/>
        <link rel="prev" title="Creating a Release" href="CreateRelease.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> VisIt User Manual
          

          
          </a>

          
            
            
              <div class="version">
                local build
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gui_manual/index.html">GUI Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_manual/index.html">CLI Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pr_create.html">Creating a Pull Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="pr_review.html">Reviewing a Pull Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="RCDevelopment.html">Release Candidate (RC) Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="CreateRelease.html">Creating a Release</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-docker-on-windows">Installing Docker on Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-docker-container">Creating a Docker Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-dockerfile-from-scratch">Creating a Dockerfile From Scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#useful-docker-commands">Useful Docker Commands</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VisIt User Manual</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">VisIt Developer Manual</a> &raquo;</li>
        
      <li>Using Docker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev_manual/Docker.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-docker">
<h1>Using Docker<a class="headerlink" href="#using-docker" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Docker is a platform for building containers. Containers can run either
Windows or Linux operating systems. Docker is available on the Mac, Windows
and Linux. The rest of this tutorial will primarily be focused on running
Docker on Windows. The content on installing and setting up Docker is Windows
specific but the remainder of the content on creating and using containers
is operating system independent.</p>
</div>
<div class="section" id="installing-docker-on-windows">
<h2>Installing Docker on Windows<a class="headerlink" href="#installing-docker-on-windows" title="Permalink to this headline">¶</a></h2>
<p>Install Docker on your system. It is free to download and install. You will
need to be running Windows Professional and you will need administrator
priviledges. The following link will get you started.</p>
<p><a class="reference external" href="https://docs.docker.com/docker-for-windows/">https://docs.docker.com/docker-for-windows/</a></p>
<p>You will need to enable experimental features to be able to use the
<code class="docutils literal notranslate"><span class="pre">--squash</span></code> option when building your container. You can enable experimental
features with the Settings window. Go to the <em>Daemon</em> tab and check the
<em>Experimental features</em> checkbox and press <em>Apply</em>. Note that this will
restart the Docker daemon, which will kill container builds or running
containers.</p>
<div class="figure" id="id1">
<img alt="../_images/Docker-Settings1.png" src="../_images/Docker-Settings1.png" />
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">Enabling experimental features.</span></p>
</div>
<p>If you run into problems running out of disk space, you can increase the
amount of disk space allocated to Docker with the Settings window. Go to
the <em>Advanced</em> tab and move the <em>Disk image max size</em> to the right to increase
the amount of disk space and press <em>Apply</em>. Note that this will restart the
Docker daemon, which will kill container builds or running containers.</p>
<div class="figure" id="id2">
<img alt="../_images/Docker-Settings2.png" src="../_images/Docker-Settings2.png" />
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Increasing the disk space allocated to Docker.</span></p>
</div>
</div>
<div class="section" id="creating-a-docker-container">
<h2>Creating a Docker Container<a class="headerlink" href="#creating-a-docker-container" title="Permalink to this headline">¶</a></h2>
<p>First you will want to bring up a Command window and use that to run Docker
commands. Next we’ll create a folder to hold all our Docker files. We are
assuming that you are at the root of the C: drive.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="o">&gt;</span><span class="n">cd</span> \<span class="n">Users</span>\<span class="n">brugger1</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger1</span><span class="o">&gt;</span><span class="n">mkdir</span> <span class="n">docker</span>
<span class="n">C</span><span class="p">:</span><span class="n">cd</span> <span class="n">docker</span>
</pre></div>
</div>
<p>Now you need to copy all the relevant files to your docker folder. You
must have the following files in your folder.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger1</span>\<span class="n">docker</span><span class="o">&gt;</span><span class="nb">dir</span>
 <span class="n">Volume</span> <span class="ow">in</span> <span class="n">drive</span> <span class="n">C</span> <span class="ow">is</span> <span class="n">Windows</span>
 <span class="n">Volume</span> <span class="n">Serial</span> <span class="n">Number</span> <span class="ow">is</span> <span class="n">A8F6</span><span class="o">-</span><span class="mi">9</span><span class="n">F9C</span>

 <span class="n">Directory</span> <span class="n">of</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger1</span>\<span class="n">docker</span>

<span class="mi">09</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">02</span><span class="p">:</span><span class="mi">46</span> <span class="n">PM</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">.</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">02</span><span class="p">:</span><span class="mi">46</span> <span class="n">PM</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">..</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">02</span><span class="p">:</span><span class="mi">39</span> <span class="n">PM</span>           <span class="mi">737</span><span class="p">,</span><span class="mi">636</span> <span class="n">build_visit3_0_2</span>
<span class="mi">08</span><span class="o">/</span><span class="mi">28</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">01</span><span class="p">:</span><span class="mi">45</span> <span class="n">PM</span>             <span class="mi">1</span><span class="p">,</span><span class="mi">173</span> <span class="n">build_visit_docker_cleanup</span><span class="o">.</span><span class="n">py</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">12</span><span class="p">:</span><span class="mi">24</span> <span class="n">PM</span>             <span class="mi">1</span><span class="p">,</span><span class="mi">322</span> <span class="n">Dockerfile</span><span class="o">-</span><span class="n">debian9</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">07</span><span class="p">:</span><span class="mi">27</span> <span class="n">AM</span>             <span class="mi">1</span><span class="p">,</span><span class="mi">176</span> <span class="n">Dockerfile</span><span class="o">-</span><span class="n">fedora27</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">03</span><span class="p">:</span><span class="mi">49</span> <span class="n">PM</span>             <span class="mi">1</span><span class="p">,</span><span class="mi">337</span> <span class="n">Dockerfile</span><span class="o">-</span><span class="n">ubuntu16</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">12</span><span class="p">:</span><span class="mi">36</span> <span class="n">PM</span>             <span class="mi">1</span><span class="p">,</span><span class="mi">321</span> <span class="n">Dockerfile</span><span class="o">-</span><span class="n">ubuntu18</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">12</span><span class="p">:</span><span class="mi">23</span> <span class="n">PM</span>               <span class="mi">216</span> <span class="n">run_build_visit</span><span class="o">.</span><span class="n">sh</span>
<span class="mi">09</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2019</span>  <span class="mi">02</span><span class="p">:</span><span class="mi">39</span> <span class="n">PM</span>       <span class="mi">121</span><span class="p">,</span><span class="mi">776</span><span class="p">,</span><span class="mi">180</span> <span class="n">visit3</span><span class="o">.</span><span class="mf">0.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
               <span class="mi">8</span> <span class="n">File</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    <span class="mi">122</span><span class="p">,</span><span class="mi">520</span><span class="p">,</span><span class="mi">361</span> <span class="nb">bytes</span>
               <span class="mi">2</span> <span class="n">Dir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="mi">814</span><span class="p">,</span><span class="mi">047</span><span class="p">,</span><span class="mi">002</span><span class="p">,</span><span class="mi">624</span> <span class="nb">bytes</span> <span class="n">free</span>
</pre></div>
</div>
<p>These files can be found in the <a class="reference external" href="https://visit.llnl.gov">VisIt</a> repository at GitHub in the following
location.</p>
<p><a class="reference external" href="https://github.com/visit-dav/visit/tree/develop/scripts/docker">https://github.com/visit-dav/visit/tree/develop/scripts/docker</a></p>
<p>The Dockerfile determines the type of operating system you will build your
container with. The first line in the Dockerfile contains information about
the operating system. Here is a link to a reference on Dockerfile.</p>
<p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<p>The Dockerfile will need to be specific to the operating system since the
way you install packages and do other administrative tasks will vary among
different Linux operating systems, although there are only a few unique
varients that the rest are built on. You can go to the Docker Hub to find
Linux distributions to start with.</p>
<p><a class="reference external" href="https://hub.docker.com/_/ubuntu">https://hub.docker.com/_/ubuntu</a></p>
<p><a class="reference external" href="https://hub.docker.com/_/debian">https://hub.docker.com/_/debian</a></p>
<p><a class="reference external" href="https://hub.docker.com/_/fedora">https://hub.docker.com/_/fedora</a></p>
<p>In this example the Dockerfile is set up to use Ubuntu 16. The Dockerfile
installs all the packages needed to build <a class="reference external" href="https://visit.llnl.gov">VisIt</a> and then uses build_visit
to create all the third party libraries as well as the config site file.
The build will take several hours. Sometimes I have had it stop sending
text to the Command window, so if it looks like it is hung, it may
actually be happily progressing along.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger1</span>\<span class="n">docker</span><span class="o">&gt;</span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">f</span> <span class="n">Dockerfile</span><span class="o">-</span><span class="n">ubuntu16</span> <span class="o">-</span><span class="n">t</span> <span class="n">visitdev</span><span class="p">:</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">ubuntu16</span> <span class="o">.</span> <span class="o">--</span><span class="n">squash</span>
</pre></div>
</div>
<p>Start up the container and run it interactively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>C:\Users\brugger\docker&gt;docker run -t -i visitdev:3.0.2-ubuntu16 /bin/bash visit@bea87fee3276:~$
</pre></div>
</div>
<p>Now the container is ready for you to build <a class="reference external" href="https://visit.llnl.gov">VisIt</a>. First, you need to copy
the tar file with the source code. To do this, you will need to go to another
Command window and use the container id shown in the prompt.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger</span>\<span class="n">docker</span><span class="o">&gt;</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">visit3</span><span class="o">.</span><span class="mf">0.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="n">bea87fee3276</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">visit</span>
</pre></div>
</div>
<p>Now go back to the first Command window and create your distribution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>visit@bea87fee3276:~$ tar zxf visit3.0.2.tar.gz
visit@bea87fee3276:~$ cd visit3.0.2
visit@bea87fee3276:~/visit3.0.2$ mkdir build
visit@bea87fee3276:~/visit3.0.2$ cd build
visit@bea87fee3276:~/visit3.0.2/build$ /home/visit/third-party/cmake/3.9.3/linux-x86_64_gcc-5.4/bin/cmake \
   -DCMAKE_BUILD_TYPE:STRING=Release -DVISIT_INSTALL_THIRD_PARTY:BOOL=ON -DVISIT_ENABLE_XDB:BOOL=ON \
   -DVISIT_PARADIS:BOOL=ON -DVISIT_CONFIG_SITE=&quot;/home/visit/visit-config.cmake&quot; ../src
visit@bea87fee3276:~/visit3.0.2/build$ make -j 4 package
visit@bea87fee3276:~/visit3.0.2/build$ mv visit3_0_2.linux-x86_64.tar.gz ../..
</pre></div>
</div>
<p>Now let’s test it to make sure we can create an image.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>visit@bea87fee3276:~/visit3.0.2/build$ cd ../..
visit@bea87fee3276:~$ cp visit3.0.2/src/tools/dev/scripts/visit-install .
visit@bea87fee3276:~$ ./visit-install 3.0.2 linux-x86_64 visit
visit@bea87fee3276:~$ visit/bin/visit -cli -nowin
&gt;&gt;&gt; OpenDatabase(&quot;visit/data/curv2d.silo&quot;)
&gt;&gt;&gt; AddPlot(&quot;Pseudocolor&quot;, &quot;d&quot;)
&gt;&gt;&gt; DrawPlots()
&gt;&gt;&gt; SaveWindow()
&gt;&gt;&gt; quit()
visit@:~$
</pre></div>
</div>
<p>Now let’s go back to the second Command window and copy the binary
distribution back out of the container and the image we created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger</span>\<span class="n">docker</span><span class="o">&gt;</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">bea87fee3276</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">visit</span><span class="o">/</span><span class="n">visit3_0_2</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">.</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">brugger</span>\<span class="n">docker</span><span class="o">&gt;</span><span class="n">docker</span> <span class="n">cp</span> <span class="n">bea87fee3276</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">visit</span><span class="o">/</span><span class="n">visit0000</span><span class="o">.</span><span class="n">png</span> <span class="o">.</span>
</pre></div>
</div>
<p>At this point you can exit your container.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>visit@bea87fee3276:~$ exit
C:\Users\brugger\docker&gt;
</pre></div>
</div>
<p>You should view the image to verify that it was produced correctly. You
now have the binary distribution for <a class="reference external" href="https://visit.llnl.gov">VisIt</a> 3.0.2 for Ubuntu 16.</p>
</div>
<div class="section" id="creating-a-dockerfile-from-scratch">
<h2>Creating a Dockerfile From Scratch<a class="headerlink" href="#creating-a-dockerfile-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>To create a Dockerfile from scratch it is best to do so running interactively
as root with the base operating system image. You can start by installing
packages that your are certain you will need. At that point you can run
build_visit until it fails, determining what missing package caused the
failure, installing the missing package and repeating until you have gotten
build_visit to complete with the third party libraries you want to build.
From that experience you can create your Dockerfile.</p>
</div>
<div class="section" id="useful-docker-commands">
<h2>Useful Docker Commands<a class="headerlink" href="#useful-docker-commands" title="Permalink to this headline">¶</a></h2>
<p>Here are some useful Docker commands.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
<span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span> <span class="o">--</span><span class="nb">all</span>
<span class="n">docker</span> <span class="n">image</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">image</span> <span class="nb">id</span><span class="o">&gt;</span>
<span class="n">docker</span> <span class="n">container</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">container</span> <span class="nb">id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Docker will create a “checkpoint” after each command it executes. Everytime
you partially create an image or execute a container it is saving those
checkpoints. This can quickly start to consume a lot of disk space, so you
should frequently list your images and containers and remove those that you
no longer need.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="CreateRelease.html" class="btn btn-neutral" title="Creating a Release" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2008-2019, LLNL, UCRL-SM-220449.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>